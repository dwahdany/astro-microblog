---
import { render } from 'astro:content';
import type { BlogmarkItem } from '../../lib/types';
import { getItemUrl } from '../../lib/content';
import TagList from './TagList.astro';

interface Props {
  blogmark: BlogmarkItem;
}

const { blogmark } = Astro.props;
const url = getItemUrl({ type: 'blogmark', item: blogmark });
const domain = new URL(blogmark.data.link_url).hostname.replace('www.', '');
const { Content } = await render(blogmark);
---

<article class="group">
  <div class="flex items-start gap-2">
    <a href={url} class="text-terminal-accent-blue shrink-0 mt-0.5 hover:text-terminal-accent-cyan transition-colors">@</a>
    <div class="flex-1 min-w-0">
      <h3 class="text-base font-medium">
        <a
          href={blogmark.data.link_url}
          class="text-terminal-accent-blue hover:text-terminal-accent-cyan transition-colors"
          target="_blank"
          rel="noopener noreferrer"
        >
          {blogmark.data.link_title}
        </a>
        <span class="text-terminal-muted text-sm ml-2">({domain})</span>
      </h3>
      <div class="mt-2 text-terminal-muted text-sm prose prose-sm max-w-none">
        <Content />
      </div>
      <div class="mt-2 flex items-center gap-3 text-xs text-terminal-muted">
        <a href={url} class="text-terminal-muted hover:text-terminal-accent-cyan transition-colors">
          <time datetime={blogmark.data.created.toISOString()}>
            {blogmark.data.created.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' })}
          </time>
        </a>
        {blogmark.data.via_url && (
          <>
            <span class="text-terminal-border">•</span>
            <span>
              via{' '}
              <a
                href={blogmark.data.via_url}
                class="hover:text-terminal-accent-cyan transition-colors"
                target="_blank"
                rel="noopener noreferrer"
              >
                {blogmark.data.via_title || 'link'}
              </a>
            </span>
          </>
        )}
        {blogmark.data.tags.length > 0 && (
          <>
            <span class="text-terminal-border">•</span>
            <TagList tags={blogmark.data.tags} />
          </>
        )}
      </div>
    </div>
  </div>
</article>
